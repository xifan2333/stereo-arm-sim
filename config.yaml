# 全局配置文件
# 遵循小步骤迭代原则，仅包含基础必要配置

# 摄像头配置
camera:
  # 双目摄像头分辨率
  width: 1280  # 总宽度(左右两个画面)
  height: 480

  # 单目画面分辨率
  single_width: 640  # 单个画面宽度
  single_height: 480

  # 摄像头索引
  camera_indices: [0, 1, 2]  # 尝试的摄像头索引列表

  # API后端
  backend: "DSHOW"  # Windows使用DSHOW, Linux使用V4L2

  # 显示窗口
  windows:
    left: "left"
    right: "right"

# 相机标定参数
# 注意：这些参数需要根据实际相机重新标定
calibration:
  # 左相机内参矩阵
  camera_matrix_left:
    - [410.3084, -0.2777, 309.3976]
    - [0.0, 410.2129, 262.0564]
    - [0.0, 0.0, 1.0]

  # 左相机畸变系数
  dist_coeffs_left: [0.0027, 0.6848, -0.0043, 0.0066, -2.0220]

  # 右相机内参矩阵
  camera_matrix_right:
    - [409.2531, -0.3487, 299.1536]
    - [0.0, 408.9821, 265.7137]
    - [0.0, 0.0, 1.0]

  # 右相机畸变系数
  dist_coeffs_right: [0.0357, 0.3211, -0.0042, 0.0035, -0.7268]

  # 旋转矩阵 R (3x3)
  R:
    - [0.999780788646075, 0.0004806193456666200, 0.020931881407937]
    - [-0.0004322695666685383, 0.999997228514369, -0.0006092913311984787]
    - [-0.020932935705560, 0.002304770839986, 0.999778225525102]

  # 平移向量 T (单位：毫米，基线长度≈61.4mm)
  T: [-61.114637167122600, -0.044597478744966, 0.583576573837856]

  # 图像尺寸
  image_size: [640, 480]  # [width, height]

# 立体匹配配置 (SGBM)
stereo_matching:
  # SGBM 基本参数
  window_size: 5
  min_disparity: 0
  num_disparities: 128  # 必须是16的倍数

  # SGBM 高级参数
  uniqueness_ratio: 15  # 增加以减少误匹配 (默认10-15)
  speckle_window_size: 100  # 减小以更激进地去除斑点
  speckle_range: 1  # 减小以更严格地过滤
  disp12_max_diff: 1  # 减小以提高左右一致性
  pre_filter_cap: 63
  mode: "SGBM_3WAY"  # SGBM, SGBM_3WAY, HH, HH4

  # 预处理
  use_clahe: true
  clahe_clip_limit: 2.0
  clahe_tile_size: [8, 8]

  # 后处理
  postprocess:
    # 中值滤波
    median_filter: true
    median_kernel_size: 5

    # 双边滤波
    bilateral_filter: true
    bilateral_d: 5
    bilateral_sigma_color: 9.0
    bilateral_sigma_space: 7.0

    # WLS滤波（如果可用）
    use_wls: true
    wls_lambda: 8000.0
    wls_sigma: 1.5

  # 显示窗口
  windows:
    disparity_left: "Disparity Left"
    disparity_right: "Disparity Right"

# YOLO 检测配置
detection:
  # 模型配置
  model_path: "yolo11s-seg.pt"  # 使用分割模型
  device: "cuda:0"  # cuda:0 或 cpu

  # 推理参数
  conf_threshold: 0.25  # 置信度阈值
  iou_threshold: 0.45  # NMS IoU 阈值
  max_det: 100  # 最大检测数量

  # 只检测特定类别（可选，null 表示检测所有类别）
  classes: null  # 例如 [0, 39, 41] 表示只检测 person, bottle, cup

  # 可视化
  show_boxes: true  # 显示边界框
  show_masks: true  # 显示分割掩码
  show_labels: true  # 显示类别标签
  show_conf: true  # 显示置信度
  line_width: 2  # 边框线宽
  mask_alpha: 0.3  # 掩码透明度

  # 3D尺寸信息显示
  show_3d_info: true  # 是否显示3D位置和尺寸
  info_bg_color: [255, 255, 255]  # 信息背景色 (白色)
  info_text_color: [0, 0, 0]  # 信息文字颜色 (黑色)
  info_font_scale: 0.4
  info_thickness: 1

  # 显示窗口
  window: "YOLO Detection"

# 三维重建配置
reconstruction:
  # 3D可视化器
  viewer:
    # 图形尺寸 (宽, 高)
    figsize: [12, 9]

    # 坐标轴范围 (mm)
    x_range: [-400, 400]  # 左右各40cm
    y_range: [0, 800]     # 深度0-80cm
    z_range: [-400, 400]  # 垂直-30cm到40cm

    # 坐标轴指示器长度 (mm)
    axis_length: 200

    # 窗口标题
    window_title: "三维物体重建"

    # 点云显示
    pointcloud:
      color: "cyan"
      size: 2.0
      alpha: 0.5
      max_points: 2000  # 下采样点数

    # 包围盒显示
    bbox:
      color: "lime"
      linewidth: 2.0

    # 文本标签
    label:
      color: "white"
      fontsize: 9
      offset_z: 50  # 文本向上偏移 (mm)


# 日志配置
logging:
  level: INFO  # TRACE, DEBUG, INFO, SUCCESS, WARNING, ERROR, CRITICAL
  format: "<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>"

  # 控制台输出
  console:
    enabled: true
    colorize: true

  # 文件输出
  file:
    enabled: true
    path: "data/logs/stereo-arm-sim.log"
    rotation: "100 MB"
    retention: "7 days"
    compression: "zip"
    encoding: "utf-8"

  # 错误日志单独输出
  error_file:
    enabled: true
    path: "data/logs/error.log"
    rotation: "50 MB"
    retention: "30 days"
    compression: "zip"
    encoding: "utf-8"
    level: "ERROR"


